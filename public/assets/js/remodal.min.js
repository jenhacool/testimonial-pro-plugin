!function(root,factory){"function"==typeof define&&define.amd?define(["jquery"],(function($){return factory(root,$)})):"object"==typeof exports?factory(root,require("jquery")):factory(root,root.jQuery||root.Zepto)}(this,(function(global,$){"use strict";var PLUGIN_NAME="remodal",NAMESPACE=global.REMODAL_GLOBALS&&global.REMODAL_GLOBALS.NAMESPACE||PLUGIN_NAME,ANIMATIONSTART_EVENTS=$.map(["animationstart","webkitAnimationStart","MSAnimationStart","oAnimationStart"],(function(eventName){return eventName+"."+NAMESPACE})).join(" "),ANIMATIONEND_EVENTS=$.map(["animationend","webkitAnimationEnd","MSAnimationEnd","oAnimationEnd"],(function(eventName){return eventName+"."+NAMESPACE})).join(" "),DEFAULTS=$.extend({hashTracking:!0,closeOnConfirm:!0,closeOnCancel:!0,closeOnEscape:!0,closeOnOutsideClick:!0,modifier:"",appendTo:null},global.REMODAL_GLOBALS&&global.REMODAL_GLOBALS.DEFAULTS),STATES={CLOSING:"closing",CLOSED:"closed",OPENING:"opening",OPENED:"opened"},STATE_CHANGE_REASONS={CONFIRMATION:"confirmation",CANCELLATION:"cancellation"},IS_ANIMATION=void 0!==(style=document.createElement("div").style).animationName||void 0!==style.WebkitAnimationName||void 0!==style.MozAnimationName||void 0!==style.msAnimationName||void 0!==style.OAnimationName,style,IS_IOS=/iPad|iPhone|iPod/.test(navigator.platform),current,scrollTop;function getAnimationDuration($elem){if(IS_ANIMATION&&"none"===$elem.css("animation-name")&&"none"===$elem.css("-webkit-animation-name")&&"none"===$elem.css("-moz-animation-name")&&"none"===$elem.css("-o-animation-name")&&"none"===$elem.css("-ms-animation-name"))return 0;var duration=$elem.css("animation-duration")||$elem.css("-webkit-animation-duration")||$elem.css("-moz-animation-duration")||$elem.css("-o-animation-duration")||$elem.css("-ms-animation-duration")||"0s",delay=$elem.css("animation-delay")||$elem.css("-webkit-animation-delay")||$elem.css("-moz-animation-delay")||$elem.css("-o-animation-delay")||$elem.css("-ms-animation-delay")||"0s",iterationCount=$elem.css("animation-iteration-count")||$elem.css("-webkit-animation-iteration-count")||$elem.css("-moz-animation-iteration-count")||$elem.css("-o-animation-iteration-count")||$elem.css("-ms-animation-iteration-count")||"1",max,len,num,i;for(duration=duration.split(", "),delay=delay.split(", "),iterationCount=iterationCount.split(", "),i=0,len=duration.length,max=Number.NEGATIVE_INFINITY;i<len;i++)(num=parseFloat(duration[i])*parseInt(iterationCount[i],10)+parseFloat(delay[i]))>max&&(max=num);return max}function getScrollbarWidth(){if($(document).height()<=$(window).height())return 0;var outer=document.createElement("div"),inner=document.createElement("div"),widthNoScroll,widthWithScroll;return outer.style.visibility="hidden",outer.style.width="100px",document.body.appendChild(outer),widthNoScroll=outer.offsetWidth,outer.style.overflow="scroll",inner.style.width="100%",outer.appendChild(inner),widthWithScroll=inner.offsetWidth,outer.parentNode.removeChild(outer),widthNoScroll-widthWithScroll}function lockScreen(){if(!IS_IOS){var $html=$("html"),lockedClass=namespacify("is-locked"),paddingRight,$body;$html.hasClass(lockedClass)||($body=$(document.body),paddingRight=parseInt($body.css("padding-right"),10)+getScrollbarWidth(),$body.css("padding-right",paddingRight+"px"),$html.addClass(lockedClass))}}function unlockScreen(){if(!IS_IOS){var $html=$("html"),lockedClass=namespacify("is-locked"),paddingRight,$body;$html.hasClass(lockedClass)&&($body=$(document.body),paddingRight=parseInt($body.css("padding-right"),10)-getScrollbarWidth(),$body.css("padding-right",paddingRight+"px"),$html.removeClass(lockedClass))}}function setState(instance,state,isSilent,reason){var newState=namespacify("is",state),allStates=[namespacify("is",STATES.CLOSING),namespacify("is",STATES.OPENING),namespacify("is",STATES.CLOSED),namespacify("is",STATES.OPENED)].join(" ");instance.$bg.removeClass(allStates).addClass(newState),instance.$overlay.removeClass(allStates).addClass(newState),instance.$wrapper.removeClass(allStates).addClass(newState),instance.$modal.removeClass(allStates).addClass(newState),instance.state=state,!isSilent&&instance.$modal.trigger({type:state,reason:reason},[{reason:reason}])}function syncWithAnimation(doBeforeAnimation,doAfterAnimation,instance){var runningAnimationsCount=0,handleAnimationStart=function(e){e.target===this&&runningAnimationsCount++},handleAnimationEnd=function(e){e.target===this&&0==--runningAnimationsCount&&($.each(["$bg","$overlay","$wrapper","$modal"],(function(index,elemName){instance[elemName].off(ANIMATIONSTART_EVENTS+" "+ANIMATIONEND_EVENTS)})),doAfterAnimation())};$.each(["$bg","$overlay","$wrapper","$modal"],(function(index,elemName){instance[elemName].on(ANIMATIONSTART_EVENTS,handleAnimationStart).on(ANIMATIONEND_EVENTS,handleAnimationEnd)})),doBeforeAnimation(),0===getAnimationDuration(instance.$bg)&&0===getAnimationDuration(instance.$overlay)&&0===getAnimationDuration(instance.$wrapper)&&0===getAnimationDuration(instance.$modal)&&($.each(["$bg","$overlay","$wrapper","$modal"],(function(index,elemName){instance[elemName].off(ANIMATIONSTART_EVENTS+" "+ANIMATIONEND_EVENTS)})),doAfterAnimation())}function halt(instance){instance.state!==STATES.CLOSED&&($.each(["$bg","$overlay","$wrapper","$modal"],(function(index,elemName){instance[elemName].off(ANIMATIONSTART_EVENTS+" "+ANIMATIONEND_EVENTS)})),instance.$bg.removeClass(instance.settings.modifier),instance.$overlay.removeClass(instance.settings.modifier).hide(),instance.$wrapper.hide(),unlockScreen(),setState(instance,STATES.CLOSED,!0))}function parseOptions(str){var obj={},arr,len,val,i;for(i=0,len=(arr=(str=str.replace(/\s*:\s*/g,":").replace(/\s*,\s*/g,",")).split(",")).length;i<len;i++)arr[i]=arr[i].split(":"),("string"==typeof(val=arr[i][1])||val instanceof String)&&(val="true"===val||"false"!==val&&val),("string"==typeof val||val instanceof String)&&(val=isNaN(val)?val:+val),obj[arr[i][0]]=val;return obj}function namespacify(){for(var result=NAMESPACE,i=0;i<arguments.length;++i)result+="-"+arguments[i];return result}function handleHashChangeEvent(){var id=location.hash.replace("#",""),instance,$elem;if(id){try{$elem=$("[data-"+PLUGIN_NAME+'-id="'+id+'"]')}catch(err){}$elem&&$elem.length&&(instance=$[PLUGIN_NAME].lookup[$elem.data(PLUGIN_NAME)])&&instance.settings.hashTracking&&instance.open()}else current&&current.state===STATES.OPENED&&current.settings.hashTracking&&current.close()}function Remodal($modal,options){var $body,$appendTo=$(document.body),remodal=this;remodal.settings=$.extend({},DEFAULTS,options),remodal.index=$[PLUGIN_NAME].lookup.push(remodal)-1,remodal.state=STATES.CLOSED,remodal.$overlay=$("."+namespacify("overlay")),null!==remodal.settings.appendTo&&remodal.settings.appendTo.length&&($appendTo=$(remodal.settings.appendTo)),remodal.$overlay.length||(remodal.$overlay=$("<div>").addClass(namespacify("overlay")+" "+namespacify("is",STATES.CLOSED)).hide(),$appendTo.append(remodal.$overlay)),remodal.$bg=$("."+namespacify("bg")).addClass(namespacify("is",STATES.CLOSED)),remodal.$modal=$modal.addClass(NAMESPACE+" "+namespacify("is-initialized")+" "+remodal.settings.modifier+" "+namespacify("is",STATES.CLOSED)).attr("tabindex","-1"),remodal.$wrapper=$("<div>").addClass(namespacify("wrapper")+" "+remodal.settings.modifier+" "+namespacify("is",STATES.CLOSED)).hide().append(remodal.$modal),$appendTo.append(remodal.$wrapper),remodal.$wrapper.on("click."+NAMESPACE,"[data-"+PLUGIN_NAME+'-action="close"]',(function(e){e.preventDefault(),remodal.close()})),remodal.$wrapper.on("click."+NAMESPACE,"[data-"+PLUGIN_NAME+'-action="cancel"]',(function(e){e.preventDefault(),remodal.$modal.trigger(STATE_CHANGE_REASONS.CANCELLATION),remodal.settings.closeOnCancel&&remodal.close(STATE_CHANGE_REASONS.CANCELLATION)})),remodal.$wrapper.on("click."+NAMESPACE,"[data-"+PLUGIN_NAME+'-action="confirm"]',(function(e){e.preventDefault(),remodal.$modal.trigger(STATE_CHANGE_REASONS.CONFIRMATION),remodal.settings.closeOnConfirm&&remodal.close(STATE_CHANGE_REASONS.CONFIRMATION)})),remodal.$wrapper.on("click."+NAMESPACE,(function(e){var $target;$(e.target).hasClass(namespacify("wrapper"))&&remodal.settings.closeOnOutsideClick&&remodal.close()}))}Remodal.prototype.open=function(){var remodal=this,id;remodal.state!==STATES.OPENING&&remodal.state!==STATES.CLOSING&&((id=remodal.$modal.attr("data-"+PLUGIN_NAME+"-id"))&&remodal.settings.hashTracking&&(scrollTop=$(window).scrollTop(),location.hash=id),current&&current!==remodal&&halt(current),current=remodal,lockScreen(),remodal.$bg.addClass(remodal.settings.modifier),remodal.$overlay.addClass(remodal.settings.modifier).show(),remodal.$wrapper.show().scrollTop(0),remodal.$modal.focus(),syncWithAnimation((function(){setState(remodal,STATES.OPENING)}),(function(){setState(remodal,STATES.OPENED)}),remodal))},Remodal.prototype.close=function(reason){var remodal=this;remodal.state!==STATES.OPENING&&remodal.state!==STATES.CLOSING&&remodal.state!==STATES.CLOSED&&(remodal.settings.hashTracking&&remodal.$modal.attr("data-"+PLUGIN_NAME+"-id")===location.hash.substr(1)&&(location.hash="",$(window).scrollTop(scrollTop)),syncWithAnimation((function(){setState(remodal,STATES.CLOSING,!1,reason)}),(function(){remodal.$bg.removeClass(remodal.settings.modifier),remodal.$overlay.removeClass(remodal.settings.modifier).hide(),remodal.$wrapper.hide(),unlockScreen(),setState(remodal,STATES.CLOSED,!1,reason)}),remodal))},Remodal.prototype.getState=function(){return this.state},Remodal.prototype.destroy=function(){var lookup=$[PLUGIN_NAME].lookup,instanceCount;halt(this),this.$wrapper.remove(),delete lookup[this.index],0===(instanceCount=$.grep(lookup,(function(instance){return!!instance})).length)&&(this.$overlay.remove(),this.$bg.removeClass(namespacify("is",STATES.CLOSING)+" "+namespacify("is",STATES.OPENING)+" "+namespacify("is",STATES.CLOSED)+" "+namespacify("is",STATES.OPENED)))},$[PLUGIN_NAME]={lookup:[]},$.fn[PLUGIN_NAME]=function(opts){var instance,$elem;return this.each((function(index,elem){null==($elem=$(elem)).data(PLUGIN_NAME)?(instance=new Remodal($elem,opts),$elem.data(PLUGIN_NAME,instance.index),instance.settings.hashTracking&&$elem.attr("data-"+PLUGIN_NAME+"-id")===location.hash.substr(1)&&instance.open()):instance=$[PLUGIN_NAME].lookup[$elem.data(PLUGIN_NAME)]})),instance},$(document).ready((function(){$(document).on("click","[data-"+PLUGIN_NAME+"-target]",(function(e){e.preventDefault();var elem,id=e.currentTarget.getAttribute("data-"+PLUGIN_NAME+"-target"),$target=$("[data-"+PLUGIN_NAME+'-id="'+id+'"]');$[PLUGIN_NAME].lookup[$target.data(PLUGIN_NAME)].open()})),$(document).find("."+NAMESPACE).each((function(i,container){var $container=$(container),options=$container.data(PLUGIN_NAME+"-options");options?("string"==typeof options||options instanceof String)&&(options=parseOptions(options)):options={},$container[PLUGIN_NAME](options)})),$(document).on("keydown."+NAMESPACE,(function(e){current&&current.settings.closeOnEscape&&current.state===STATES.OPENED&&27===e.keyCode&&current.close()})),$(window).on("hashchange."+NAMESPACE,handleHashChangeEvent)}))}));